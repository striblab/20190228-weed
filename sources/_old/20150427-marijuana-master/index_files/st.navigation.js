(function(window,document,$,_,FastClick,undefined){'use strict';var $window=$(window);var $document=$(document);var $body=$('body');var isTouch=$('.touch').length?true:false;var $globalNavWrapper=$('.js-global-nav-mod');var $lvl2Container=$('.js-navigation-lvl-2-container');var searchMenuOpen=false;var sectionsMenuOpen=false;var topOffset=0;var activeLevel;var debouncedSetLvl;var allowClose=false;var drawerWidth=175;var delta=1000;var lastClickTime=0;function setDelta(){var current=new Date().getTime();delta=current- lastClickTime;lastClickTime=current;}
function checkDelta(){setDelta();if(delta<700){return false;}
return true;}
function hoverNavIn(){var $this=$(this);var subnavTarget=$this.data('subnav-target');var $target=$lvl2Container.find('[data-subnav-list="'+ subnavTarget+'"]');var $navTriggers=$target.find('.js-lvl-item.has-items');activeLevel=$this.data('lvl');if(activeLevel===1){$lvl2Container.find('.js-nav-sections-group').removeClass('is-active');}else if(activeLevel===2){$lvl2Container.find('.lvl-3.js-nav-sections-group').removeClass('is-active');}
$('.lvl-item.active').removeClass('active');$this.addClass('active');$target.addClass('is-active');setLvlPos($navTriggers);allowClose=false;}
function hoverNavOut(){$lvl2Container.find('.js-nav-sections-group').removeClass('is-active');allowClose=true;}
function mainHoverOut(){if(allowClose){hoverNavOut();hideSectionsMenu();}}
function hideSearchMenu(){$globalNavWrapper.removeClass('is-showing-search-menu');searchMenuOpen=false;}
function hideSectionsMenu(){$globalNavWrapper.removeClass('is-showing-sections-menu');$('.touch .js-lvl-item.active').removeClass('active');sectionsMenuOpen=false;}
function setLvlPos($els){var $navTriggers=$els;$navTriggers.each(function(){var $this=$(this);var triggerTop=yPosInWindow($window,$this)+ topOffset;var subnavTarget=$this.data('subnav-target');var $target=$lvl2Container.find('[data-subnav-list="'+ subnavTarget+'"]');var topVal=($window.height()- $target.height()- 20);var navHeight=$(".l-navigation-shortnav-container").length?$(".l-navigation-shortnav-container").height():40;if(!$target.hasClass('pos-is-set')){if(topVal<navHeight){topVal=navHeight;}
if(triggerTop+ $target.height()>=$window.height()){$target.css('top',topVal);}else{$target.css('top',triggerTop);}}
$target.addClass('pos-is-set');});}
function yPosInWindow($win,$el){var ypos=$el.offset().top- $win.scrollTop();return ypos;}
function setTouchHandlers(){FastClick.attach(document.body);$('.touch .js-lvl-item a, .touch .js-lvl-item span').off('touchstart').on('touchstart',function(e){var $this=$(this);var $target=$this.parent();if($target.hasClass('has-items')){hoverNavIn.call($target);var clicky=$target.hasClass('tapped');return clicky;}});$('.touch .js-lvl-item a').off('touchend').on('touchend',function(e){$('.tapped').removeClass('tapped');var $this=$(this);var $target=$this.parent();if(!$target.hasClass('has-items')){hideSectionsMenu();location.href=$this.attr('href');}else{$target.addClass('tapped');}});$('.touch .js-lvl-item.active a').off('click').on('click',function(e){e.preventDefault();$(this).parent().addClass('active');});if($('.js-navigation-sections-mod').hasScrollBar()){$('.js-navigation-sections-mod').css('overflowY',"scroll");}}
function setNoTouchHandlers(){$('.no-touch .js-lvl-item').hoverIntent({over:hoverNavIn,out:function(){},sensitivity:6,interval:100,timeout:0});$('.no-touch .js-navigation-container').hoverIntent({over:function(){},out:hoverNavOut,sensitivity:6,interval:0,timeout:200});$('.no-touch .js-navigation-sections-mod').hoverIntent({over:function(){},out:mainHoverOut,interval:0,timeout:800});}
function positionMenu($primaryMenu,primaryMenuOffset,primaryMenuHeight){if(checkDelta()){var windowWidth=$window.width();var btnX=$('.js-show-sections-menu').offset().left;primaryMenuOffset=btnX;var maxHeight=$window.height()- 65;if(maxHeight>primaryMenuHeight){maxHeight=primaryMenuHeight;}
if($('.l-navigation-responsive').length){var responsiveWidth=$('.l-navigation-responsive').width();if(responsiveWidth>300){var primaryMenuWidth=300;}else{var primaryMenuWidth=responsiveWidth;}}else{primaryMenuWidth='175';}
$primaryMenu.css({'left':btnX+'px','height':maxHeight+"px",'width':primaryMenuWidth+'px'});if($('html').hasClass('ie9')){$primaryMenu.css({'width':primaryMenuWidth+ 17+'px'});}
$('.navigation-sections-mod-triangle').css({'left':btnX+'px'});$('.lvl-2').css('left',primaryMenuOffset+ drawerWidth+'px');$('.lvl-3').css('left',primaryMenuOffset+(drawerWidth*2)+'px');$globalNavWrapper.toggleClass('is-showing-sections-menu');var tempDiv=$("<div class='js-check-width'>");$('.js-navigation-sections-mod').append(tempDiv);var tempDivWidth=$('.js-check-width').width();$('.js-navigation-sections-mod .has-arrow').css('background-position',(drawerWidth-(drawerWidth- tempDivWidth)- 12)+'px 50%');$('.js-check-width').remove();sectionsMenuOpen=!sectionsMenuOpen;}
return false;}
function init(){var $primaryMenu=$('.js-navigation-primary-sections-mod');var primaryMenuHeight=$primaryMenu.outerHeight();var primaryMenuOffset;var showMenuCookie=jQuery.cookie('st_usr_menu_display_tip');var showMenu=false;if(FeatureAPI_JS_TipsNavigation){var now=Math.round($.now()/ 1000);
if(typeof(showMenuCookie)==='undefined'){showMenu=true;}else{if(now>showMenuCookie){showMenu=true;}}}
if(showMenu){document.getElementById('nav-tooltip').style.display='block';document.getElementById('nav-tooltip').innerHTML="<strong>Tip:</strong> click or tap to find your favorite sections";var domain=window.location.hostname.split('.');if(domain[0]!='startribune'){domain.shift();}
jQuery.cookie('st_usr_menu_display_tip',((now+ 86400)*3),{expires:3,domain:'.'+ domain.join('.'),path:'/'});positionMenu($primaryMenu,primaryMenuOffset,primaryMenuHeight);setTimeout(function(){$globalNavWrapper.removeClass('is-showing-sections-menu');document.getElementById('nav-tooltip').innerHTML=" ";document.getElementById('nav-tooltip').style.display='none';},8000);}
setLvlPos($('.js-lvl-item.lvl-1-item.has-items'));debouncedSetLvl=_.debounce(function(){$('.js-nav-sections-group').removeClass('pos-is-set');setLvlPos($('.js-lvl-item.lvl-1-item.has-items'));},200);$window.off('resize').on('resize',debouncedSetLvl);$('.js-nav-user-dropdown').off('click').on('click','.js-nav-user-dropdown-trigger',function(e){e.preventDefault();if($('.js-nav-user-dropdown').hasClass('show-user-menu')){$('.js-nav-user-dropdown').trigger('click');}
$(this).parent().toggleClass('show-user-menu');});$('.js-nav-subscriptions-dropdown').off('click').on('click','.js-nav-subscriptions-dropdown-trigger',function(e){e.preventDefault();if($('.js-nav-subscriptions-dropdown').hasClass('show-subscriptions-menu')){$('.js-nav-subscriptions-dropdown').trigger('click');}
$(this).parent().toggleClass('show-subscriptions-menu');});$('.js-show-search-menu, .js-close-search-menu').off('click').on('click',function(){$globalNavWrapper.toggleClass('is-showing-search-menu');searchMenuOpen=!searchMenuOpen;return false;});$('.js-show-sections-menu').off('click touchstart').on('click touchstart',function(){if(isTouch){$('.tapped').removeClass('tapped');hoverNavOut();$('.touch .js-lvl-item.active').removeClass('active');}
return positionMenu($primaryMenu,primaryMenuOffset,primaryMenuHeight);});$document.off('click touchstart').on('click touchstart',function(event){if(searchMenuOpen&&!$(event.target).closest('.js-search-menu-mod').length){event.preventDefault();hideSearchMenu();}
if(sectionsMenuOpen&&!$(event.target).closest('.js-navigation-sections-mod').length){event.preventDefault();hoverNavOut();hideSectionsMenu();}
if($('.js-nav-user-dropdown').hasClass('show-user-menu')&&!$(event.target).closest('.js-nav-user-dropdown-trigger').length){event.preventDefault();$('.js-nav-user-dropdown').removeClass('show-user-menu');}
if($('.js-nav-subscriptions-dropdown').hasClass('show-subscriptions-menu')&&!$(event.target).closest('.js-nav-subscriptions-dropdown-trigger').length){event.preventDefault();$('.js-nav-subscriptions-dropdown').removeClass('show-subscriptions-menu');}});if($body.hasClass('page-home')||$body.hasClass('page-section')){$window.scroll(function(){if($window.scrollTop()>250){$globalNavWrapper.addClass('js-show-shortnav');}else{$globalNavWrapper.removeClass('js-show-shortnav');}});}
$document.keyup(function(e){if(e.keyCode===27){hideSearchMenu();hoverNavOut();hideSectionsMenu();}});return isTouch?setTouchHandlers():setNoTouchHandlers();}
$(document).ready(init);}(window,window.document,window.jQuery,window._,window.FastClick));(function($){$.fn.hasScrollBar=function(){return this.get(0)?this.get(0).scrollHeight>this.innerHeight():false;};})(jQuery);